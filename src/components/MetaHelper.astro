---
import { pwaConfig } from "../pwa-config";

interface Props {
  title?: string;
  description?: string;
  pathname?: string;
  image?: string;
  imageAlt?: string;
  keywords?: string;
  type?: 'website' | 'article' | string;
  published?: string | null;
  updated?: string | null;
  locale?: string;
  twitter?: string;
  canonical?: string;
}

const props = Astro.props as Props;
const site = import.meta.env.SITE || (Astro as any).site || 'https://community.corespark.io';
const baseName = pwaConfig?.name ?? 'Corespark Community Center';

const pageTitle = props.title ? `${props.title} | ${baseName}` : baseName;
const description = props.description ?? pwaConfig?.description ?? '';
const pathname = props.pathname ?? String((Astro as any).url?.pathname ?? '/');
const canonical = props.canonical ?? `${site}${pathname.startsWith('/') ? pathname : '/' + pathname}`;
const image = props.image ?? '/logo-512x512.webp';
const imageUrl = new URL(image, site).href;
const imageAlt = props.imageAlt ?? baseName;
const keywords = props.keywords ?? 'community center, events, volunteers, workshops, local resources, inclusive';
const type = props.type ?? 'website';
const locale = props.locale ?? 'en_US';
const twitterHandle = props.twitter ?? '';

const jsonLd: Record<string, any> = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  name: pwaConfig?.name ?? baseName,
  url: site,
  logo: new URL('/logo-192x192.webp', site).href,
  description,
};

if (props.published || props.updated) {
  jsonLd.mainEntityOfPage = {
    '@type': 'WebPage',
    datePublished: props.published,
    dateModified: props.updated ?? props.published
  };
}
---

<title>{pageTitle}</title>
<link rel="canonical" href={canonical} />
<meta name="description" content={description} />
<meta name="keywords" content={keywords} />
<meta name="robots" content="index, follow" />
<meta name="theme-color" content={pwaConfig?.themeColor ?? '#ffffff'} />

<meta property="og:type" content={type} />
<meta property="og:site_name" content={pwaConfig?.name ?? baseName} />
<meta property="og:title" content={pageTitle} />
<meta property="og:description" content={description} />
<meta property="og:image" content={imageUrl} />
<meta property="og:image:alt" content={imageAlt} />
<meta property="og:url" content={canonical} />
<meta property="og:locale" content={locale} />

<meta name="twitter:card" content={image ? 'summary_large_image' : 'summary'} />
{twitterHandle && <meta name="twitter:site" content={twitterHandle} />}
<meta name="twitter:title" content={pageTitle} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={imageUrl} />

{props.published && <meta property="article:published_time" content={props.published} />}
{props.updated && <meta property="article:modified_time" content={props.updated} />}

<script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />